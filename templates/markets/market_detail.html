{% load static %}
<!DOCTYPE html>
<html lang="ko">
    <head>
        <link rel="stylesheet" href="{% static 'css/style.css' %}">
    </head>
    <body>        
        <div id="navbar">
            <h1>{{ market.name }} </h1>
            {% if user.business_number %}
            <h2> 
                <a href = "{% url 'markets:market_edit' market_id=market.id %}">마켓 정보 수정하기</a>  
                <a href = "{% url 'markets:market_delete'  market_id=market.id%}">마켓 삭제하기</a>     
            </h2>
            {% endif %}
        </div>  
        <div class="market_butons">
            <form action="{% url 'markets:market_like' market_id=market.id %}?next={{ action_redirect_url }}"
            method = "POST">
            {% csrf_token %}
            <button type="submit"
                {% if user in market.like_users.all %}
                    style="color: red;"
                {% endif %}>
                <!-- Post의 좋아요를 누른 사용자 수를 가져옴 -->
                Likes({{ market.like_users.count }})
            </button>
            </form>
        <div class="post-images splide">
            <div class="splide__track">
                <ul class="splide__list">
                    {% for image in market.marketimage_set.all %}
                        {% if image.photo %}
                            <li class="splide__slide">
                                <img src="{{ image.photo.url }}">
                            </li>
                        {% endif %}
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div id="market-content">
            <p>{{ market.content|linebreaksbr }}</p>
                <div class="post-tags">
                    {% for tag in market.tags.all %}
                        <span>#{{ tag.name }}</span>
                    {% endfor %}
                </div>
            </div>
            <ul class="comments">
                <span>Comments({{ market.comment_set.count }})</span>
                {% for comment in market.comment_set.all %}
                    <li>
                        <span>{{ comment.user.username }}</span>
                        <span>{{ comment.content }}</span>
                    
                <!-- 댓글 삭제 Form 추가 -->
                    {% if user == comment.user %}
                        <form method="POST" action="/markets/{{ comment.id }}/comment_delete/">                                        
                        {% csrf_token %}
                        <button type="submit">삭제</button>
                        </form>
                    {% endif %}
                    </li>   
                {% endfor %}
            </ul>
            <div class = "post-comment-create">
            <form method="POST" action="{% url 'markets:comment_add' market_id=market.id %}?next={{ action_redirect_url }}" >
                
                {% csrf_token %}
                <input type = "hidden" name = "market" value = "{{ market_id }}">
                {{ comment_form.content }}
                <button type="submit" class="btn btn-primary">리뷰 작성</button>
            </form>
        </div>
    </body>
</html>